The inverted pendulum was another old thing laying around the department that was thrown into my hands. The contraption is based in the chassis of an A3 plotter. A special cart was designed to substitute the printing thing. A more powerfull servomechanism was put in place of the old printer servo, and hooked to it an encoder so one can read the position. On the cart there's a rotational encoder and a custom metal installation to hold a long metal bar. The objective is to hold the bar in the vertical position, while mainting the cart in the middle of the chassis.

This example uses the parapin library to access the parallel port. Much like the blackbox, most of the common IO is hidden behind the .h. Each block maintains its own IO operations because it makes sense in this case. It's handy.

The more interesting thing in this example is that the DA_servo block has a secondary task to produce the PWM signal to control the servo. The duty cycle of the PWM is modulated by the input. To make the cart move back and forth, for instance, you can hook up a signal_generator to the block and generate a sine wave. The duty cycle will vary according to the sine.
Another interesting thing was the ability to have the block output the PWM wave form. To do this, the PWM task commutes the hardware and a dummy variable. The periodic_function grabs this variable and returns its value encapsulated in a matrix.
